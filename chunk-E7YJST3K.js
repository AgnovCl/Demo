import{a as ye}from"./chunk-AYGNVWRE.js";import{a as Ee}from"./chunk-BDNWTLA3.js";import{b as Se}from"./chunk-SOLGGFDN.js";import{$ as G,$a as Z,Bb as be,D as _,E as n,Eb as ve,F as o,G as b,H as V,I as v,J as P,N as c,O as S,P as E,S as y,T as x,U as w,V as F,W as A,X as L,Y as z,Ya as J,Z as H,Za as Q,_ as D,_a as Y,bb as $,cb as ee,db as ie,eb as te,gb as ne,ib as oe,jb as ae,lb as re,mb as le,n as k,na as q,nb as ce,o as R,ob as se,pa as X,pb as me,qb as de,rb as pe,sb as fe,u as f,ua as K,vb as ue,w as T,wb as _e,xb as ge,y as W,z as h,zb as he}from"./chunk-KFCX55XD.js";import"./chunk-24WMRY7Q.js";import"./chunk-QUJFQN2Y.js";import"./chunk-PPLOLVG2.js";import"./chunk-WRVDKWF6.js";import"./chunk-YGW4HXY5.js";import"./chunk-BMJVVMK5.js";import"./chunk-S6AMPHJZ.js";import"./chunk-EEG35UFA.js";import"./chunk-WBVABYLX.js";import"./chunk-UD3XTG5V.js";import"./chunk-FOFIWYID.js";import"./chunk-JOTLW5X2.js";import"./chunk-3PF4GKYE.js";import"./chunk-BLSTF7EF.js";import"./chunk-3IVKBF6N.js";import"./chunk-M2X7KQLB.js";import"./chunk-UIFIQKDK.js";import"./chunk-42C7ZIID.js";import"./chunk-C5RQ2IC2.js";import"./chunk-AJI4VUU4.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-BKXINAYE.js";import"./chunk-CKP3SGE2.js";import"./chunk-XF2R5JSX.js";import{e as Fe,f as Ce,g as B}from"./chunk-2R6CW7ES.js";var xe=Fe((O,N)=>{"use strict";(function(a,m){typeof define=="function"&&define.amd?define([],m):typeof O<"u"?m():(m(),a.FileSaver={})})(O,function(){"use strict";function a(e,l){return typeof l>"u"?l={autoBom:!1}:typeof l!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),l={autoBom:!l}),l.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\uFEFF",e],{type:e.type}):e}function m(e,l,d){var p=new XMLHttpRequest;p.open("GET",e),p.responseType="blob",p.onload=function(){u(p.response,l,d)},p.onerror=function(){console.error("could not download file")},p.send()}function r(e){var l=new XMLHttpRequest;l.open("HEAD",e,!1);try{l.send()}catch{}return 200<=l.status&&299>=l.status}function s(e){try{e.dispatchEvent(new MouseEvent("click"))}catch{var l=document.createEvent("MouseEvents");l.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(l)}}var t=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof global=="object"&&global.global===global?global:void 0,i=t.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),u=t.saveAs||(typeof window!="object"||window!==t?function(){}:"download"in HTMLAnchorElement.prototype&&!i?function(e,l,d){var p=t.URL||t.webkitURL,g=document.createElement("a");l=l||e.name||"download",g.download=l,g.rel="noopener",typeof e=="string"?(g.href=e,g.origin===location.origin?s(g):r(g.href)?m(e,l,d):s(g,g.target="_blank")):(g.href=p.createObjectURL(e),setTimeout(function(){p.revokeObjectURL(g.href)},4e4),setTimeout(function(){s(g)},0))}:"msSaveOrOpenBlob"in navigator?function(e,l,d){if(l=l||e.name||"download",typeof e!="string")navigator.msSaveOrOpenBlob(a(e,d),l);else if(r(e))m(e,l,d);else{var p=document.createElement("a");p.href=e,p.target="_blank",setTimeout(function(){s(p)})}}:function(e,l,d,p){if(p=p||open("","_blank"),p&&(p.document.title=p.document.body.innerText="downloading..."),typeof e=="string")return m(e,l,d);var g=e.type==="application/octet-stream",Ie=/constructor/i.test(t.HTMLElement)||t.safari,U=/CriOS\/[\d]+/.test(navigator.userAgent);if((U||g&&Ie||i)&&typeof FileReader<"u"){var C=new FileReader;C.onloadend=function(){var I=C.result;I=U?I:I.replace(/^data:[^;]*;/,"data:attachment/file;"),p?p.location.href=I:location=I,p=null},C.readAsDataURL(e)}else{var j=t.URL||t.webkitURL,M=j.createObjectURL(e);p?p.location=M:location.href=M,p=null,setTimeout(function(){j.revokeObjectURL(M)},4e4)}});t.saveAs=u.saveAs=u,typeof N<"u"&&(N.exports=u)})});var we=Ce(xe());function Me(a,m){if(a&1&&(n(0,"ion-select-option",15),c(1),o()),a&2){let r=m.$implicit;_("value",r),f(),S(r)}}function Te(a,m){if(a&1&&(n(0,"ion-select-option",15),c(1),o()),a&2){let r=m.$implicit;_("value",r),f(),S(r)}}function Pe(a,m){if(a&1&&(n(0,"ion-select-option",15),c(1),o()),a&2){let r=m.$implicit;_("value",r),f(),S(r)}}function Ae(a,m){if(a&1&&(n(0,"ion-select-option",15),c(1),o()),a&2){let r=m.$implicit;_("value",r),f(),S(r)}}function Le(a,m){if(a&1){let r=V();n(0,"ion-button",16),v("click",function(){k(r);let t=P();return R(t.exportarCSV())}),b(1,"ion-icon",17),c(2," Exportar a CSV "),o()}}function Oe(a,m){a&1&&(n(0,"div",18),b(1,"ion-spinner",19),n(2,"p"),c(3,"Cargando existencias..."),o()())}function Ne(a,m){a&1&&(n(0,"div",20),b(1,"ion-icon",21),n(2,"h3"),c(3,"No se encontraron existencias"),o(),n(4,"p"),c(5,"Ajusta los filtros para ver resultados."),o()())}function Ue(a,m){if(a&1&&(n(0,"ion-item")(1,"ion-label")(2,"b"),c(3,"N\xB0 Serie:"),o(),c(4),b(5,"br"),n(6,"b"),c(7,"Fecha ingreso:"),o(),c(8),b(9,"br"),n(10,"b"),c(11,"Ubicaci\xF3n:"),o(),c(12),b(13,"br"),n(14,"b"),c(15,"Activo fijo:"),o(),c(16),b(17,"br"),n(18,"b"),c(19,"Costo neto:"),o(),c(20),A(21,"currency"),b(22,"br"),n(23,"b"),c(24,"Precio venta:"),o(),c(25),A(26,"currency"),o()()),a&2){let r=m.$implicit;f(4),E(" ",r.numeroSerie),f(4),E(" ",r.fechaIngreso),f(4),E(" ",(r.ubicacion==null?null:r.ubicacion.nombre)||"-"),f(4),E(" ",r.activoFijo?"S\xED":"No"),f(4),E(" ",L(21,6,r.costoNeto,"CLP")),f(5),E(" ",L(26,9,r.precioVenta,"CLP")," ")}}function je(a,m){if(a&1&&(n(0,"ion-accordion",15)(1,"ion-item",25)(2,"ion-label"),c(3),o()(),n(4,"div",23)(5,"ion-list"),h(6,Ue,27,12,"ion-item",26),o()()()),a&2){let r=m.$implicit;_("value",F(r.nombre)),f(3),S(r.nombre),f(3),_("ngForOf",r.items)}}function Be(a,m){if(a&1&&(n(0,"ion-accordion",15)(1,"ion-item",24)(2,"ion-label"),c(3),o()(),n(4,"div",23)(5,"ion-accordion-group"),h(6,je,7,4,"ion-accordion",7),o()()()),a&2){let r=m.$implicit;_("value",F(r.familia)),f(3),S(r.familia),f(3),_("ngForOf",r.productos)}}function ke(a,m){if(a&1&&(n(0,"ion-accordion",15)(1,"ion-item",22)(2,"ion-label")(3,"b"),c(4),o()()(),n(5,"div",23)(6,"ion-accordion-group"),h(7,Be,7,4,"ion-accordion",7),o()()()),a&2){let r=m.$implicit;_("value",F(r.marca)),f(4),S(r.marca),f(3),_("ngForOf",r.familias)}}function Re(a,m){if(a&1&&(n(0,"div")(1,"ion-accordion-group"),h(2,ke,8,4,"ion-accordion",7),o()()),a&2){let r=P();f(2),_("ngForOf",r.agrupado)}}var Qe=(()=>{let m=class m{constructor(s,t){this.productService=s,this.authService=t,this.productos=[],this.agrupado=[],this.marcas=[],this.familias=[],this.nombres=[],this.ubicaciones=[],this.filtroMarca="",this.filtroFamilia="",this.filtroNombre="",this.filtroSerie="",this.filtroUbicacion="",this.loading=!1}ngOnInit(){this.cargarProductos()}cargarProductos(){return B(this,null,function*(){this.loading=!0,this.productos=(yield this.productService.getProducts().toPromise())||[],this.marcas=Array.from(new Set(this.productos.map(s=>s.marca))).sort(),this.filtrarOpciones(),this.agrupar(),this.loading=!1})}filtrarOpciones(){let s=this.productos;this.filtroMarca&&(s=s.filter(t=>t.marca===this.filtroMarca)),this.familias=Array.from(new Set(s.map(t=>t.familia))).sort(),this.filtroFamilia&&(s=s.filter(t=>t.familia===this.filtroFamilia)),this.nombres=Array.from(new Set(s.map(t=>t.nombre))).sort(),this.ubicaciones=Array.from(new Set(this.productos.map(t=>t.ubicacion?.nombre).filter(t=>!!t))).sort()}aplicarFiltros(){this.filtrarOpciones(),this.agrupar()}agrupar(){let s=this.productos;this.filtroMarca&&(s=s.filter(i=>i.marca===this.filtroMarca)),this.filtroFamilia&&(s=s.filter(i=>i.familia===this.filtroFamilia)),this.filtroNombre&&(s=s.filter(i=>i.nombre===this.filtroNombre)),this.filtroSerie&&(s=s.filter(i=>i.numeroSerie.toLowerCase().includes(this.filtroSerie.toLowerCase()))),this.filtroUbicacion&&(s=s.filter(i=>i.ubicacion?.nombre===this.filtroUbicacion));let t=[];for(let i of Array.from(new Set(s.map(u=>u.marca)))){let u=[];for(let e of Array.from(new Set(s.filter(l=>l.marca===i).map(l=>l.familia)))){let l=[];for(let d of Array.from(new Set(s.filter(p=>p.marca===i&&p.familia===e).map(p=>p.nombre)))){let p=s.filter(g=>g.marca===i&&g.familia===e&&g.nombre===d);l.push({nombre:d,items:p})}u.push({familia:e,productos:l})}t.push({marca:i,familias:u})}this.agrupado=t}limpiarFiltros(){this.filtroMarca="",this.filtroFamilia="",this.filtroNombre="",this.filtroSerie="",this.filtroUbicacion="",this.aplicarFiltros()}esAdmin(){return this.authService.hasRole(Se.Administrador)}exportarCSV(){let s=[],t=this.productos;this.filtroMarca&&(t=t.filter(d=>d.marca===this.filtroMarca)),this.filtroFamilia&&(t=t.filter(d=>d.familia===this.filtroFamilia)),this.filtroNombre&&(t=t.filter(d=>d.nombre===this.filtroNombre)),this.filtroSerie&&(t=t.filter(d=>d.numeroSerie.toLowerCase().includes(this.filtroSerie.toLowerCase()))),this.filtroUbicacion&&(t=t.filter(d=>d.ubicacion?.nombre===this.filtroUbicacion)),s=t;let i="Marca,Familia,Nombre,N\xB0 Serie,Ubicaci\xF3n,Fecha Ingreso,Activo Fijo,Costo Neto,Precio Venta",u=s.map(d=>[d.marca,d.familia,d.nombre,d.numeroSerie,d.ubicacion?.nombre||"",d.fechaIngreso,d.activoFijo?"S\xED":"No",d.costoNeto,d.precioVenta].join(",")),e=[i,...u].join(`
`),l=new Blob([e],{type:"text/csv;charset=utf-8;"});(0,we.saveAs)(l,"existencias.csv")}};m.\u0275fac=function(t){return new(t||m)(T(ye),T(Ee))},m.\u0275cmp=W({type:m,selectors:[["app-existencias"]],decls:61,vars:15,consts:[[3,"translucent"],[3,"fullscreen"],["collapse","condense"],["size","large"],["size","12","size-md","4"],["interface","popover",3,"ngModelChange","ionChange","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],["placeholder","Buscar por serie",3,"ngModelChange","ionInput","ngModel"],["size","12","size-md","4",1,"ion-align-self-end"],["expand","block","color","medium",3,"click"],["expand","block","color","primary","class","ion-margin-bottom",3,"click",4,"ngIf"],["class","loading-container",4,"ngIf"],["class","empty-state",4,"ngIf"],[4,"ngIf"],[3,"value"],["expand","block","color","primary",1,"ion-margin-bottom",3,"click"],["name","download-outline","slot","start"],[1,"loading-container"],["name","crescent"],[1,"empty-state"],["name","cube-outline","size","large"],["slot","header","color","light"],["slot","content"],["slot","header","color","medium"],["slot","header","color","white"],[4,"ngFor","ngForOf"]],template:function(t,i){t&1&&(n(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),c(3,"Existencias"),o()()(),n(4,"ion-content",1)(5,"ion-header",2)(6,"ion-toolbar")(7,"ion-title",3),c(8,"Existencias"),o()()(),n(9,"ion-card")(10,"ion-card-header")(11,"ion-card-title"),c(12,"Filtros"),o()(),n(13,"ion-card-content")(14,"ion-grid")(15,"ion-row")(16,"ion-col",4)(17,"ion-item")(18,"ion-label"),c(19,"Marca"),o(),n(20,"ion-select",5),w("ngModelChange",function(e){return x(i.filtroMarca,e)||(i.filtroMarca=e),e}),v("ionChange",function(){return i.aplicarFiltros()}),n(21,"ion-select-option",6),c(22,"Todas"),o(),h(23,Me,2,2,"ion-select-option",7),o()()(),n(24,"ion-col",4)(25,"ion-item")(26,"ion-label"),c(27,"Familia"),o(),n(28,"ion-select",5),w("ngModelChange",function(e){return x(i.filtroFamilia,e)||(i.filtroFamilia=e),e}),v("ionChange",function(){return i.aplicarFiltros()}),n(29,"ion-select-option",6),c(30,"Todas"),o(),h(31,Te,2,2,"ion-select-option",7),o()()(),n(32,"ion-col",4)(33,"ion-item")(34,"ion-label"),c(35,"Producto"),o(),n(36,"ion-select",5),w("ngModelChange",function(e){return x(i.filtroNombre,e)||(i.filtroNombre=e),e}),v("ionChange",function(){return i.aplicarFiltros()}),n(37,"ion-select-option",6),c(38,"Todos"),o(),h(39,Pe,2,2,"ion-select-option",7),o()()()(),n(40,"ion-row")(41,"ion-col",4)(42,"ion-item")(43,"ion-label"),c(44,"N\xB0 Serie"),o(),n(45,"ion-input",8),w("ngModelChange",function(e){return x(i.filtroSerie,e)||(i.filtroSerie=e),e}),v("ionInput",function(){return i.aplicarFiltros()}),o()()(),n(46,"ion-col",4)(47,"ion-item")(48,"ion-label"),c(49,"Ubicaci\xF3n"),o(),n(50,"ion-select",5),w("ngModelChange",function(e){return x(i.filtroUbicacion,e)||(i.filtroUbicacion=e),e}),v("ionChange",function(){return i.aplicarFiltros()}),n(51,"ion-select-option",6),c(52,"Todas"),o(),h(53,Ae,2,2,"ion-select-option",7),o()()(),n(54,"ion-col",9)(55,"ion-button",10),v("click",function(){return i.limpiarFiltros()}),c(56," Limpiar filtros "),o()()()()()(),h(57,Le,3,0,"ion-button",11)(58,Oe,4,0,"div",12)(59,Ne,6,0,"div",13)(60,Re,3,1,"div",14),o()),t&2&&(_("translucent",!0),f(4),_("fullscreen",!0),f(16),y("ngModel",i.filtroMarca),f(3),_("ngForOf",i.marcas),f(5),y("ngModel",i.filtroFamilia),f(3),_("ngForOf",i.familias),f(5),y("ngModel",i.filtroNombre),f(3),_("ngForOf",i.nombres),f(6),y("ngModel",i.filtroSerie),f(5),y("ngModel",i.filtroUbicacion),f(3),_("ngForOf",i.ubicaciones),f(4),_("ngIf",i.esAdmin()),f(),_("ngIf",i.loading),f(),_("ngIf",!i.loading&&i.agrupado.length===0),f(),_("ngIf",!i.loading&&i.agrupado.length>0))},dependencies:[G,z,H,D,ve,Y,Z,$,ee,ie,te,ne,oe,ae,re,le,ce,se,me,de,pe,fe,ue,_e,ge,he,be,J,Q,K,q,X],encapsulation:2});let a=m;return a})();export{Qe as ExistenciasPage};
