import{a as x,b as U}from"./chunk-Q4DHKWRX.js";import{$ as T,D as _,E as t,Eb as Q,F as e,G as w,H as f,I as u,J as s,L as F,M as I,N as i,O as p,P as S,S as h,T as P,U as C,Y as V,Ya as N,Z as D,Za as R,bb as z,ga as k,kb as H,n as m,na as W,nb as Y,o as g,ob as j,pa as L,pb as q,qb as G,u as l,ua as B,va as A,vb as J,w as M,wb as K,y,z as v}from"./chunk-KFCX55XD.js";import"./chunk-24WMRY7Q.js";import"./chunk-QUJFQN2Y.js";import"./chunk-PPLOLVG2.js";import"./chunk-WRVDKWF6.js";import"./chunk-YGW4HXY5.js";import"./chunk-BMJVVMK5.js";import"./chunk-S6AMPHJZ.js";import"./chunk-EEG35UFA.js";import"./chunk-WBVABYLX.js";import"./chunk-UD3XTG5V.js";import"./chunk-FOFIWYID.js";import"./chunk-JOTLW5X2.js";import"./chunk-3PF4GKYE.js";import"./chunk-BLSTF7EF.js";import"./chunk-3IVKBF6N.js";import"./chunk-M2X7KQLB.js";import"./chunk-UIFIQKDK.js";import"./chunk-42C7ZIID.js";import"./chunk-C5RQ2IC2.js";import"./chunk-AJI4VUU4.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-BKXINAYE.js";import"./chunk-CKP3SGE2.js";import"./chunk-XF2R5JSX.js";import"./chunk-2R6CW7ES.js";function Z(d,c){if(d&1){let n=f();t(0,"ion-button",19),u("click",function(){m(n);let r=s();return g(r.clearFilters())}),w(1,"ion-icon",20),i(2," Limpiar "),e()}}function $(d,c){if(d&1&&(t(0,"ion-select-option",41),i(1),e()),d&2){let n=c.$implicit;_("value",n.value),l(),p(n.text)}}function ee(d,c){if(d&1){let n=f();t(0,"div",21)(1,"div",22)(2,"ion-item",23)(3,"ion-label"),i(4,"N\xFAmero OC"),e(),t(5,"ion-input",24),C("ngModelChange",function(r){m(n);let a=s();return P(a.filter.numeroOc,r)||(a.filter.numeroOc=r),g(r)}),e()(),t(6,"ion-item",23)(7,"ion-label"),i(8,"Proveedor"),e(),t(9,"ion-input",25),C("ngModelChange",function(r){m(n);let a=s();return P(a.filter.proveedor,r)||(a.filter.proveedor=r),g(r)}),e()(),t(10,"ion-item",23)(11,"ion-label"),i(12,"Estado"),e(),t(13,"ion-select",26),C("ngModelChange",function(r){m(n);let a=s();return P(a.filter.estado,r)||(a.filter.estado=r),g(r)}),t(14,"ion-select-option",27),i(15,"Todos los estados"),e(),v(16,$,2,2,"ion-select-option",28),e()()(),t(17,"div",22)(18,"ion-item",23)(19,"ion-label"),i(20,"Fecha Desde"),e(),t(21,"ion-datetime",29),C("ngModelChange",function(r){m(n);let a=s();return P(a.filter.fechaDesde,r)||(a.filter.fechaDesde=r),g(r)}),e()(),t(22,"ion-item",23)(23,"ion-label"),i(24,"Fecha Hasta"),e(),t(25,"ion-datetime",29),C("ngModelChange",function(r){m(n);let a=s();return P(a.filter.fechaHasta,r)||(a.filter.fechaHasta=r),g(r)}),e()(),t(26,"ion-item",23)(27,"ion-label"),i(28,"Ordenar Por"),e(),t(29,"ion-select",30),C("ngModelChange",function(r){m(n);let a=s();return P(a.filter.ordenarPor,r)||(a.filter.ordenarPor=r),g(r)}),t(30,"ion-select-option",27),i(31,"Sin ordenar"),e(),t(32,"ion-select-option",31),i(33,"N\xFAmero OC"),e(),t(34,"ion-select-option",32),i(35,"Fecha Creaci\xF3n"),e(),t(36,"ion-select-option",33),i(37,"Proveedor"),e(),t(38,"ion-select-option",34),i(39,"Total"),e()()(),t(40,"ion-item",23)(41,"ion-label"),i(42,"Orden"),e(),t(43,"ion-select",35),C("ngModelChange",function(r){m(n);let a=s();return P(a.filter.orden,r)||(a.filter.orden=r),g(r)}),t(44,"ion-select-option",36),i(45,"Descendente"),e(),t(46,"ion-select-option",37),i(47,"Ascendente"),e()()()(),t(48,"div",38)(49,"ion-button",39),u("click",function(){m(n);let r=s();return g(r.applyFilters())}),w(50,"ion-icon",40),i(51," Aplicar Filtros "),e()()()}if(d&2){let n=s();l(5),h("ngModel",n.filter.numeroOc),l(4),h("ngModel",n.filter.proveedor),l(4),h("ngModel",n.filter.estado),l(3),_("ngForOf",n.estados),l(5),h("ngModel",n.filter.fechaDesde),l(4),h("ngModel",n.filter.fechaHasta),l(4),h("ngModel",n.filter.ordenarPor),l(14),h("ngModel",n.filter.orden)}}function te(d,c){d&1&&(t(0,"div",42),w(1,"div",43),t(2,"p"),i(3,"Cargando \xF3rdenes de compra..."),e()())}function ie(d,c){if(d&1){let n=f();t(0,"div",44)(1,"h2"),i(2,"Error"),e(),t(3,"p"),i(4),e(),t(5,"button",45),u("click",function(){m(n);let r=s();return g(r.loadOrdenes())}),i(6," \u{1F504} Reintentar "),e()()}if(d&2){let n=s();l(4),p(n.error)}}function ne(d,c){if(d&1){let n=f();t(0,"tr",51)(1,"td",52)(2,"strong"),i(3),e()(),t(4,"td",53)(5,"div",54)(6,"span",55),i(7),e(),t(8,"span",56),i(9),e()()(),t(10,"td",57),i(11),e(),t(12,"td",58),i(13),e(),t(14,"td",59)(15,"span",60),i(16),e()(),t(17,"td",61)(18,"strong"),i(19),e()(),t(20,"td",62)(21,"span",63),i(22),e()(),t(23,"td",64)(24,"div",65)(25,"button",66),u("click",function(){let r=m(n).$implicit,a=s(2);return g(a.viewOrden(r.idOc))}),i(26," \u{1F441}\uFE0F "),e(),t(27,"button",67),u("click",function(){let r=m(n).$implicit,a=s(2);return g(a.editOrden(r.idOc))}),i(28," \u270F\uFE0F "),e()()()()}if(d&2){let n=c.$implicit,o=s(2);l(3),p(n.numeroOc),l(4),p(n.proveedor),l(2),p(n.rutProveedor),l(2),S(" ",o.formatDate(n.fechaCreacion)," "),l(2),S(" ",o.formatDate(n.fechaEntrega)," "),l(2),I(o.getEstadoClass(n.estado)),l(),S(" ",o.getEstadoText(n.estado)," "),l(3),p(o.formatCurrency(n.total)),l(3),S("",n.items.length," items")}}function re(d,c){if(d&1){let n=f();t(0,"button",72),u("click",function(){let r=m(n).$implicit,a=s(3);return g(a.goToPage(r))}),i(1),e()}if(d&2){let n=c.$implicit,o=s(3);F("active",n===o.currentPage),l(),S(" ",n," ")}}function oe(d,c){if(d&1){let n=f();t(0,"div",68)(1,"button",69),u("click",function(){m(n);let r=s(2);return g(r.previousPage())}),i(2," \u25C0\uFE0F Anterior "),e(),t(3,"div",70),v(4,re,2,3,"button",71),e(),t(5,"button",69),u("click",function(){m(n);let r=s(2);return g(r.nextPage())}),i(6," Siguiente \u25B6\uFE0F "),e()()}if(d&2){let n=s(2);l(),_("disabled",n.currentPage===1),l(3),_("ngForOf",n.getPageNumbers()),l(),_("disabled",n.currentPage===n.totalPages)}}function ae(d,c){if(d&1){let n=f();t(0,"div",73)(1,"div",74),i(2,"\u{1F4CB}"),e(),t(3,"h3"),i(4,"No se encontraron \xF3rdenes"),e(),t(5,"p"),i(6,"No hay \xF3rdenes de compra que coincidan con los filtros aplicados."),e(),t(7,"button",4),u("click",function(){m(n);let r=s(2);return g(r.clearFilters())}),i(8," Limpiar Filtros "),e()()}}function le(d,c){if(d&1&&(t(0,"div",46)(1,"div",47)(2,"table")(3,"thead")(4,"tr")(5,"th"),i(6,"N\xFAmero OC"),e(),t(7,"th"),i(8,"Proveedor"),e(),t(9,"th"),i(10,"Fecha Creaci\xF3n"),e(),t(11,"th"),i(12,"Fecha Entrega"),e(),t(13,"th"),i(14,"Estado"),e(),t(15,"th"),i(16,"Total"),e(),t(17,"th"),i(18,"Items"),e(),t(19,"th"),i(20,"Acciones"),e()()(),t(21,"tbody"),v(22,ne,29,10,"tr",48),e()()(),v(23,oe,7,3,"div",49)(24,ae,9,0,"div",50),e()),d&2){let n=s();l(22),_("ngForOf",n.paginatedOrdenes),l(),_("ngIf",n.totalPages>1),l(),_("ngIf",n.paginatedOrdenes.length===0)}}var fe=(()=>{let c=class c{constructor(o,r){this.ordenCompraService=o,this.router=r,this.ordenes=[],this.filteredOrdenes=[],this.isLoading=!1,this.error="",this.filter={},this.showFilters=!1,this.estados=[{value:x.Borrador,text:"Borrador"},{value:x.Enviada,text:"Enviada"},{value:x.Aprobada,text:"Aprobada"},{value:x.EnProceso,text:"En Proceso"},{value:x.Recibida,text:"Recibida"},{value:x.Cancelada,text:"Cancelada"}],this.currentPage=1,this.itemsPerPage=10,this.totalPages=1}ngOnInit(){this.loadOrdenes()}loadOrdenes(){this.isLoading=!0,this.error="",this.ordenCompraService.getOrdenes(this.filter).subscribe({next:o=>{this.ordenes=o,this.filteredOrdenes=o,this.calculatePagination(),this.isLoading=!1},error:o=>{console.error("Error cargando \xF3rdenes:",o),this.error="Error al cargar las \xF3rdenes de compra",this.isLoading=!1}})}applyFilters(){this.currentPage=1,this.loadOrdenes()}clearFilters(){this.filter={},this.currentPage=1,this.loadOrdenes()}toggleFilters(){this.showFilters=!this.showFilters}getEstadoText(o){return this.ordenCompraService.getEstadoText(o)}getEstadoClass(o){return this.ordenCompraService.getEstadoClass(o)}formatCurrency(o){return this.ordenCompraService.formatCurrency(o)}formatDate(o){return this.ordenCompraService.formatDate(o)}viewOrden(o){this.router.navigate(["/orders",o])}createOrden(){this.router.navigate(["/orders/new"])}editOrden(o){this.router.navigate(["/orders",o,"edit"])}calculatePagination(){this.totalPages=Math.ceil(this.filteredOrdenes.length/this.itemsPerPage)}get paginatedOrdenes(){let o=(this.currentPage-1)*this.itemsPerPage,r=o+this.itemsPerPage;return this.filteredOrdenes.slice(o,r)}previousPage(){this.currentPage>1&&this.currentPage--}nextPage(){this.currentPage<this.totalPages&&this.currentPage++}goToPage(o){o>=1&&o<=this.totalPages&&(this.currentPage=o)}getPageNumbers(){let o=[],a=Math.max(1,this.currentPage-Math.floor(2.5)),E=Math.min(this.totalPages,a+5-1);E-a+1<5&&(a=Math.max(1,E-5+1));for(let b=a;b<=E;b++)o.push(b);return o}get estadisticas(){let o=this.ordenes.length,r=this.ordenes.filter(O=>O.estado===x.Recibida).length,a=this.ordenes.filter(O=>O.estado===x.EnProceso).length,E=this.ordenes.filter(O=>O.estado===x.Enviada).length,b=this.ordenes.reduce((O,X)=>O+X.total,0);return{total:o,recibidas:r,enProceso:a,enviadas:E,totalValor:b}}};c.\u0275fac=function(r){return new(r||c)(M(U),M(k))},c.\u0275cmp=y({type:c,selectors:[["app-orders"]],decls:61,vars:11,consts:[[1,"page-container"],[1,"section-header"],[1,"header-left"],[1,"header-right"],[1,"btn-primary",3,"click"],[1,"card-section"],[1,"card-stat"],[1,"stat-icon"],[1,"stat-content"],[1,"stat-number"],[1,"filters-section"],[1,"filters-header"],["color","primary","fill","outline",3,"click"],["name","funnel-outline","slot","start"],["color","danger","fill","outline",3,"click",4,"ngIf"],["class","filters-content",4,"ngIf"],["class","loading",4,"ngIf"],["class","error",4,"ngIf"],["class","table-section",4,"ngIf"],["color","danger","fill","outline",3,"click"],["name","trash-outline","slot","start"],[1,"filters-content"],[1,"filter-row"],["lines","none",1,"filter-group"],["placeholder","Buscar por n\xFAmero...",3,"ngModelChange","ngModel"],["placeholder","Buscar por proveedor...",3,"ngModelChange","ngModel"],["interface","popover","placeholder","Todos los estados",3,"ngModelChange","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],["display-format","DD-MM-YYYY",3,"ngModelChange","ngModel"],["interface","popover","placeholder","Sin ordenar",3,"ngModelChange","ngModel"],["value","numeroOc"],["value","fechaCreacion"],["value","proveedor"],["value","total"],["interface","popover",3,"ngModelChange","ngModel"],["value","desc"],["value","asc"],[1,"filter-actions"],["color","success",3,"click"],["name","search-outline","slot","start"],[3,"value"],[1,"loading"],[1,"spinner"],[1,"error"],[1,"btn-retry",3,"click"],[1,"table-section"],[1,"orders-table"],["class","order-row",4,"ngFor","ngForOf"],["class","pagination",4,"ngIf"],["class","no-results",4,"ngIf"],[1,"order-row"],[1,"order-number"],[1,"order-provider"],[1,"provider-info"],[1,"provider-name"],[1,"provider-rut"],[1,"order-date"],[1,"order-delivery"],[1,"order-status"],[1,"status-badge"],[1,"order-total"],[1,"order-items"],[1,"items-count"],[1,"order-actions"],[1,"action-buttons"],["title","Ver detalles",1,"btn-view",3,"click"],["title","Editar",1,"btn-edit",3,"click"],[1,"pagination"],[1,"btn-page",3,"click","disabled"],[1,"page-numbers"],["class","btn-page-number",3,"active","click",4,"ngFor","ngForOf"],[1,"btn-page-number",3,"click"],[1,"no-results"],[1,"no-results-icon"]],template:function(r,a){r&1&&(t(0,"div",0)(1,"header",1)(2,"div",2)(3,"h1"),i(4,"\u{1F4CB} \xD3rdenes de Compra"),e(),t(5,"p"),i(6,"Gesti\xF3n completa de \xF3rdenes de compra del sistema"),e()(),t(7,"div",3)(8,"button",4),u("click",function(){return a.createOrden()}),i(9," \u2795 Nueva Orden "),e()()(),t(10,"div",5)(11,"div",6)(12,"div",7),i(13,"\u{1F4CA}"),e(),t(14,"div",8)(15,"h3"),i(16,"Total \xD3rdenes"),e(),t(17,"p",9),i(18),e()()(),t(19,"div",6)(20,"div",7),i(21,"\u2705"),e(),t(22,"div",8)(23,"h3"),i(24,"Recibidas"),e(),t(25,"p",9),i(26),e()()(),t(27,"div",6)(28,"div",7),i(29,"\u{1F504}"),e(),t(30,"div",8)(31,"h3"),i(32,"En Proceso"),e(),t(33,"p",9),i(34),e()()(),t(35,"div",6)(36,"div",7),i(37,"\u{1F4E4}"),e(),t(38,"div",8)(39,"h3"),i(40,"Enviadas"),e(),t(41,"p",9),i(42),e()()(),t(43,"div",6)(44,"div",7),i(45,"\u{1F4B0}"),e(),t(46,"div",8)(47,"h3"),i(48,"Valor Total"),e(),t(49,"p",9),i(50),e()()()(),t(51,"div",10)(52,"div",11)(53,"ion-button",12),u("click",function(){return a.toggleFilters()}),w(54,"ion-icon",13),i(55),e(),v(56,Z,3,0,"ion-button",14),e(),v(57,ee,52,8,"div",15),e(),v(58,te,4,0,"div",16)(59,ie,7,1,"div",17)(60,le,25,3,"div",18),e()),r&2&&(l(18),p(a.estadisticas.total),l(8),p(a.estadisticas.recibidas),l(8),p(a.estadisticas.enProceso),l(8),p(a.estadisticas.enviadas),l(8),p(a.formatCurrency(a.estadisticas.totalValor)),l(5),S(" ",a.showFilters?"Ocultar":"Mostrar"," Filtros "),l(),_("ngIf",a.showFilters),l(),_("ngIf",a.showFilters),l(),_("ngIf",a.isLoading),l(),_("ngIf",a.error&&!a.isLoading),l(),_("ngIf",!a.isLoading&&!a.error))},dependencies:[T,V,D,B,W,L,A,Q,z,H,Y,j,q,G,J,K,N,R],styles:["@media (max-width: 768px){.orders-container[_ngcontent-%COMP%]{padding:1rem}.orders-header[_ngcontent-%COMP%]{flex-direction:column;gap:1rem;text-align:center}.orders-header[_ngcontent-%COMP%]   .header-left[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.5rem}.stats-section[_ngcontent-%COMP%], .filters-content[_ngcontent-%COMP%]   .filter-row[_ngcontent-%COMP%]{grid-template-columns:1fr}.orders-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:.5rem;font-size:.8rem}.orders-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   .order-row[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.5rem;font-size:.9rem}.pagination[_ngcontent-%COMP%]{flex-direction:column;gap:.5rem}.pagination[_ngcontent-%COMP%]   .page-numbers[_ngcontent-%COMP%]{flex-wrap:wrap;justify-content:center}}.page-container[_ngcontent-%COMP%]{padding:24px;max-width:1400px;margin:0 auto}.section-header[_ngcontent-%COMP%]{margin-bottom:32px;text-align:center;background:var(--bg-primary);border-radius:var(--border-radius);box-shadow:var(--shadow-light);padding:2rem 1rem;border:1px solid var(--border-color)}.section-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:32px;font-weight:700;color:var(--text-primary);margin:0 0 8px}.section-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;color:var(--text-secondary);margin:0}.card-section[_ngcontent-%COMP%], .orders-content[_ngcontent-%COMP%], .orders-table[_ngcontent-%COMP%], .filters-section[_ngcontent-%COMP%]{background:var(--bg-primary);border-radius:var(--border-radius);box-shadow:var(--shadow-light);border:1px solid var(--border-color)}"]});let d=c;return d})();export{fe as OrdersPage};
