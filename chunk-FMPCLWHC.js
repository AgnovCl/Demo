import{a as ae,b as ce}from"./chunk-Q4DHKWRX.js";import{$ as V,Bb as ne,D as d,Db as oe,E as e,Eb as re,F as i,G as v,H as S,I as x,J as m,N as o,O as I,P as g,S as O,T as P,U as w,W as b,X as R,Y as T,Z as F,Za as N,_ as M,ab as A,bb as W,cb as L,db as z,eb as j,fb as H,gb as G,ib as U,jb as $,mb as q,n as p,na as k,nb as J,o as _,ob as K,pa as D,pb as Q,qb as X,rb as Y,sb as Z,u as a,ua as B,w as E,xb as ee,y,yb as te,z as u,zb as ie}from"./chunk-KFCX55XD.js";import"./chunk-24WMRY7Q.js";import"./chunk-QUJFQN2Y.js";import"./chunk-PPLOLVG2.js";import"./chunk-WRVDKWF6.js";import"./chunk-YGW4HXY5.js";import"./chunk-BMJVVMK5.js";import"./chunk-S6AMPHJZ.js";import"./chunk-EEG35UFA.js";import"./chunk-WBVABYLX.js";import"./chunk-UD3XTG5V.js";import"./chunk-FOFIWYID.js";import"./chunk-JOTLW5X2.js";import"./chunk-3PF4GKYE.js";import"./chunk-BLSTF7EF.js";import"./chunk-3IVKBF6N.js";import"./chunk-M2X7KQLB.js";import"./chunk-UIFIQKDK.js";import"./chunk-42C7ZIID.js";import"./chunk-C5RQ2IC2.js";import"./chunk-AJI4VUU4.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-BKXINAYE.js";import"./chunk-CKP3SGE2.js";import"./chunk-XF2R5JSX.js";import{g as h}from"./chunk-2R6CW7ES.js";function se(r,l){if(r&1){let t=S();e(0,"ion-item",8),x("click",function(){let n=p(t).$implicit,s=m(2);return _(s.seleccionarOrden(n))}),e(1,"ion-label")(2,"h2"),o(3),i(),e(4,"p"),o(5),i(),e(6,"p"),o(7),i()(),e(8,"ion-badge",9),o(9,"En Proceso"),i()()}if(r&2){let t=l.$implicit;a(3),I(t.numeroOc),a(2),g("Proveedor: ",t.proveedor),a(2),g("Fecha: ",t.fechaCreacion)}}function le(r,l){r&1&&(e(0,"div",10),v(1,"ion-icon",11),e(2,"h3"),o(3,"No hay \xF3rdenes en proceso"),i()())}function de(r,l){r&1&&(e(0,"div",12),v(1,"ion-spinner",13),e(2,"p"),o(3,"Cargando \xF3rdenes..."),i()())}function me(r,l){if(r&1&&(e(0,"ion-card")(1,"ion-card-header")(2,"ion-card-title"),o(3,"\xD3rdenes de Compra en Proceso"),i()(),e(4,"ion-card-content")(5,"ion-list"),u(6,se,10,3,"ion-item",5),i(),u(7,le,4,0,"div",6)(8,de,4,0,"div",7),i()()),r&2){let t=m();a(6),d("ngForOf",t.ordenesEnProceso),a(),d("ngIf",t.ordenesEnProceso.length===0&&!t.loading),a(),d("ngIf",t.loading)}}function pe(r,l){if(r&1&&(e(0,"ion-item")(1,"ion-label")(2,"h3"),o(3),i(),e(4,"p"),o(5),i(),e(6,"p"),o(7),i(),e(8,"p"),o(9),b(10,"currency"),i()()()),r&2){let t=l.$implicit;a(3),I(t.producto),a(2),I(t.descripcion),a(2),g("Cantidad ordenada: ",t.cantidad),a(2),g("Precio unitario: ",R(10,4,t.precioUnitario,"CLP"))}}function _e(r,l){if(r&1){let t=S();e(0,"ion-item")(1,"ion-label",15),o(2," N\xFAmeros de serie recibidos para "),e(3,"b"),o(4),i(),e(5,"span",23),o(6,"(Uno por l\xEDnea, o separados por coma/;)"),i()(),e(7,"ion-textarea",24),w("ngModelChange",function(n){let s=p(t).$implicit,f=m(2);return P(f.seriesIngresadas[s.idItem],n)||(f.seriesIngresadas[s.idItem]=n),_(n)}),x("ionInput",function(){let n=p(t).$implicit,s=m(2);return _(s.onSeriesChange(n.idItem,s.seriesIngresadas[n.idItem]))}),i()()}if(r&2){let t=l.$implicit,c=m(2);a(4),I(t.producto),a(3),O("ngModel",c.seriesIngresadas[t.idItem])}}function ge(r,l){if(r&1){let t=S();e(0,"ion-card")(1,"ion-card-header")(2,"ion-card-title"),o(3),i(),e(4,"ion-card-subtitle"),o(5),i()(),e(6,"ion-card-content")(7,"ion-list"),u(8,pe,11,7,"ion-item",14),i(),e(9,"ion-list"),u(10,_e,8,2,"ion-item",14),i(),e(11,"ion-item")(12,"ion-label",15),o(13,"Gu\xEDa de despacho (opcional)"),i(),e(14,"ion-input",16),w("ngModelChange",function(n){p(t);let s=m();return P(s.guiaDespacho,n)||(s.guiaDespacho=n),_(n)}),i()(),e(15,"ion-button",17),x("click",function(){p(t);let n=m();return _(n.registrarRecepcion())}),o(16," Registrar Recepci\xF3n "),i(),e(17,"ion-button",18),x("click",function(){p(t);let n=m();return _(n.ordenSeleccionada=null)}),o(18," Cancelar "),i(),e(19,"ion-row",19)(20,"ion-col",20)(21,"ion-button",21),o(22," Finalizar OC "),i()(),e(23,"ion-col",20)(24,"ion-button",22),o(25," Marcar como Abierta "),i()()()()()}if(r&2){let t=m();a(3),g("Recepci\xF3n de OC: ",t.ordenSeleccionada.numeroOc),a(2),g("Proveedor: ",t.ordenSeleccionada.proveedor),a(3),d("ngForOf",t.ordenSeleccionada.items),a(2),d("ngForOf",t.ordenSeleccionada.items),a(4),O("ngModel",t.guiaDespacho)}}var Oe=(()=>{let l=class l{constructor(c,n){this.ordenCompraService=c,this.toastController=n,this.ordenesEnProceso=[],this.ordenSeleccionada=null,this.seriesIngresadas={},this.guiaDespacho="",this.loading=!1}ngOnInit(){this.cargarOrdenesEnProceso()}cargarOrdenesEnProceso(){return h(this,null,function*(){this.loading=!0;try{this.ordenesEnProceso=(yield this.ordenCompraService.getOrdenes({estado:ae.EnProceso}).toPromise())||[]}catch{this.mostrarToast("Error al cargar \xF3rdenes de compra","danger")}finally{this.loading=!1}})}seleccionarOrden(c){this.ordenSeleccionada=c,this.seriesIngresadas={},this.guiaDespacho=""}onSeriesChange(c,n){this.seriesIngresadas[c]=n}registrarRecepcion(){return h(this,null,function*(){if(!this.ordenSeleccionada)return;if(!this.ordenSeleccionada.items.map(s=>{let f=(this.seriesIngresadas[s.idItem]||"").split(/\r?\n|,|;/).map(C=>C.trim()).filter(C=>C);return{idItem:s.idItem,series:f}}).some(s=>s.series.length>0)){this.mostrarToast("Debes ingresar al menos un n\xFAmero de serie","warning");return}this.mostrarToast("Recepci\xF3n registrada exitosamente","success"),this.cargarOrdenesEnProceso(),this.ordenSeleccionada=null,this.seriesIngresadas={},this.guiaDespacho=""})}mostrarToast(c,n){return h(this,null,function*(){yield(yield this.toastController.create({message:c,duration:2e3,color:n,position:"top"})).present()})}};l.\u0275fac=function(n){return new(n||l)(E(ce),E(oe))},l.\u0275cmp=y({type:l,selectors:[["app-recepcion-oc"]],decls:11,vars:4,consts:[[3,"translucent"],[3,"fullscreen"],["collapse","condense"],["size","large"],[4,"ngIf"],[3,"click",4,"ngFor","ngForOf"],["class","empty-state",4,"ngIf"],["class","loading-container",4,"ngIf"],[3,"click"],["color","warning"],[1,"empty-state"],["name","cube-outline","size","large"],[1,"loading-container"],["name","crescent"],[4,"ngFor","ngForOf"],["position","stacked"],["placeholder","N\xB0 gu\xEDa de despacho",3,"ngModelChange","ngModel"],["expand","block","color","primary",3,"click"],["expand","block","fill","clear","color","medium",3,"click"],[1,"ion-margin-top"],["size","6"],["expand","block","color","success","disabled",""],["expand","block","color","warning","disabled",""],[1,"hint"],["auto-grow","true","placeholder","Ej: ABC123\\nDEF456\\nGHI789",3,"ngModelChange","ionInput","ngModel"]],template:function(n,s){n&1&&(e(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),o(3,"Recepci\xF3n de Productos (OC)"),i()()(),e(4,"ion-content",1)(5,"ion-header",2)(6,"ion-toolbar")(7,"ion-title",3),o(8,"Recepci\xF3n OC"),i()()(),u(9,me,9,3,"ion-card",4)(10,ge,26,5,"ion-card",4),i()),n&2&&(d("translucent",!0),a(4),d("fullscreen",!0),a(5),d("ngIf",!s.ordenSeleccionada),a(),d("ngIf",s.ordenSeleccionada))},dependencies:[V,T,F,M,re,A,W,L,z,j,H,G,U,$,q,J,K,Q,X,Y,Z,ee,te,ie,ne,N,B,k,D],encapsulation:2});let r=l;return r})();export{Oe as RecepcionOcPage};
