import{b as n}from"./chunk-SOLGGFDN.js";import{a,b as i,c,g as l,i as u}from"./chunk-KFCX55XD.js";var g=(()=>{let t=class t{constructor(){this.currentUserSubject=new i(null),this.currentUser$=this.currentUserSubject.asObservable(),this.mockUsers=[{idUsuario:1,nombre:"Admin",apellido:"Sistema",email:"admin@agnov.cl",contrasena:"admin123",rol:n.Administrador},{idUsuario:2,nombre:"Operador",apellido:"General",email:"operador@agnov.cl",contrasena:"operador123",rol:n.Operador},{idUsuario:3,nombre:"Supervisor",apellido:"Control",email:"supervisor@agnov.cl",contrasena:"supervisor123",rol:n.Supervisor}],this.loadUserFromStorage()}login(e){let r=this.mockUsers.find(o=>o.email===e.email&&o.contrasena===e.contrasena);if(r){let o={token:this.generateMockToken(r),usuario:r,expiracion:new Date(Date.now()+864e5)};return this.setCurrentUser(r),this.saveToken(o.token),c(o).pipe(l(1e3))}return new a(o=>{setTimeout(()=>{o.error(new Error("Credenciales inv\xE1lidas"))},1e3)})}logout(){this.currentUserSubject.next(null),localStorage.removeItem("auth_token"),localStorage.removeItem("current_user")}isAuthenticated(){let e=this.getToken();console.log("AuthService - Token:",e);let r=!!e&&this.isTokenValid(e);return console.log("AuthService - Token v\xE1lido:",r),r}getCurrentUser(){return this.currentUserSubject.value}hasRole(e){return this.getCurrentUser()?.rol===e}generateMockToken(e){return btoa(JSON.stringify({userId:e.idUsuario,email:e.email,role:e.rol,exp:Date.now()+24*60*60*1e3}))}setCurrentUser(e){this.currentUserSubject.next(e),localStorage.setItem("current_user",JSON.stringify(e))}saveToken(e){localStorage.setItem("auth_token",e)}getToken(){return localStorage.getItem("auth_token")}isTokenValid(e){try{return JSON.parse(atob(e)).exp>Date.now()}catch{return!1}}loadUserFromStorage(){let e=localStorage.getItem("current_user");if(e){let r=JSON.parse(e);this.currentUserSubject.next(r)}}};t.\u0275fac=function(r){return new(r||t)},t.\u0275prov=u({token:t,factory:t.\u0275fac,providedIn:"root"});let s=t;return s})();export{g as a};
